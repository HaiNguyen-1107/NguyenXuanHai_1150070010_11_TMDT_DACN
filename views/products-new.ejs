<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·∫£n ph·∫©m m·ªõi nh·∫•t | Fashion Shop</title>
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/home.css">
    <link rel="stylesheet" href="/assets/css/footer.css">
    <link rel="stylesheet" href="/assets/css/products.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <%- include('partials/header') %>

        <!-- BREADCRUMB -->
        <div class="breadcrumb">
            <a href="/home">Trang ch·ªß</a>
            <span>‚Ä∫</span>
            <span class="current">S·∫£n ph·∫©m m·ªõi nh·∫•t</span>
        </div>

        <section class="categories">
            <div class="categories-list">
                <div class="category-item">
                    <a href="/menshirt">
                        <img src="/assets/img/menshirt.jpg">
                        <h3>√Åo nam</h3>
                    </a>
                </div>

                <div class="category-item">
                    <a href="/menpants">
                        <img src="/assets/img/menpants.jpg">
                        <h3>Qu·∫ßn nam</h3>
                    </a>
                </div>

                <div class="category-item">
                    <a href="/menaccessories">
                        <img src="/assets/img/men accessories .jpg">
                        <h3>Ph·ª• ki·ªán nam</h3>
                    </a>
                </div>

                <div class="category-item">
                    <a href="/womenshirt">
                        <img src="/assets/img/women's shirt.jpg">
                        <h3>√Åo n·ªØ</h3>
                    </a>
                </div>

                <div class="category-item">
                    <a href="/womenpants">
                        <img src="/assets/img/women's pants.jpg">
                        <h3>Qu·∫ßn n·ªØ</h3>
                    </a>
                </div>

                <div class="category-item">
                    <a href="/womenaccessories">
                        <img src="/assets/img/phukien.jpg">
                        <h3>Ph·ª• ki·ªán n·ªØ</h3>
                    </a>
                </div>
            </div>
        </section>

        <!-- ========== LAYOUT 2 C·ªòT ========== -->
        <div class="products-container">
            <div class="filter-sidebar">
                <h3 class="filter-title">B·ªô l·ªçc s·∫£n ph·∫©m</h3>

                <!-- Th∆∞∆°ng hi·ªáu -->
                <div class="filter-group">
                    <h4>Th∆∞∆°ng hi·ªáu</h4>
                    <label><input type="checkbox"> Nike</label>
                    <label><input type="checkbox"> Adidas</label>
                    <label><input type="checkbox"> Gucci</label>
                    <label><input type="checkbox"> LV</label>
                </div>

                <!-- Lo·∫°i s·∫£n ph·∫©m -->
                <div class="filter-group">
                    <h4>Lo·∫°i s·∫£n ph·∫©m</h4>
                    <label><input type="checkbox"> √Åo</label>
                    <label><input type="checkbox"> Qu·∫ßn</label>
                    <label><input type="checkbox"> Ph·ª• ki·ªán</label>
                </div>

                <!-- Gi√° -->
                <div class="filter-group">
                    <h4>Gi√°</h4>
                    <label><input type="checkbox"> D∆∞·ªõi 200k</label>
                    <label><input type="checkbox"> 200k ‚Äì 500k</label>
                    <label><input type="checkbox"> 500k ‚Äì 1 tri·ªáu</label>
                    <label><input type="checkbox"> Tr√™n 1 tri·ªáu</label>
                </div>
            </div>

            <div class="products-content">
                <!-- PH·∫¶N S·∫ÆP X·∫æP -->
                <div class="sort-section">
                    <h3 class="sort-title">S·∫£n ph·∫©m m·ªõi nh·∫•t</h3>
                    <div class="sort-dropdown">
                        <button class="sort-button">
                            S·∫Øp x·∫øp theo
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="sort-options">
                            <div class="sort-option active">M·∫∑c ƒë·ªãnh</div>
                            <div class="sort-option">A ‚Äì Z</div>
                            <div class="sort-option">Z ‚Äì A</div>
                            <div class="sort-option">Gi√° tƒÉng d·∫ßn</div>
                            <div class="sort-option">Gi√° gi·∫£m d·∫ßn</div>
                        </div>
                    </div>
                </div>

                <div class="product-list">
                    <% products.forEach(p=> { %>
                        <div class="product-card">
                            <a href="/product/<%= p.ProductID %>" class="product-link">
                                <div class="product-img">
                                    <img src="<%= p.Image %>" alt="<%= p.ProductName %>">
                                </div>
                                <div class="product-info">
                                    <h4 class="product-name">
                                        <%= p.ProductName %>
                                    </h4>
                                    <p class="product-price">
                                        <%= p.Price.toLocaleString() %>ƒë
                                    </p>
                                </div>
                            </a>

                            <div class="product-actions">
                                <button class="btn-wishlist"><i class="fa-regular fa-heart"></i></button>
                                <button class="btn-add-cart" data-id="<%= p.ProductID %>"
                                    data-name="<%= p.ProductName %>" data-price="<%= p.Price %>"
                                    data-image="<%= p.Image %>">
                                    <i class="fa-solid fa-cart-shopping"></i>
                                </button>
                            </div>
                        </div>
                        <% }) %>
                </div>
            </div>
        </div>

        <%- include('partials/footer') %>

            <script>

                // Th√™m s·ª± ki·ªán cho n√∫t th√™m v√†o gi·ªè h√†ng
                document.querySelectorAll('.btn-add-cart').forEach(button => {
                    button.addEventListener('click', async function (e) {
                        e.preventDefault();
                        e.stopPropagation();

                        // üî• FIX: L·∫•y th√¥ng tin s·∫£n ph·∫©m v√† variant m·∫∑c ƒë·ªãnh
                        const productId = parseInt(this.getAttribute('data-id'));

                        // G·ªçi API ƒë·ªÉ l·∫•y variant m·∫∑c ƒë·ªãnh (m√†u ƒëen, size S)
                        try {
                            const response = await fetch(`/api/product/${productId}/default-variant`);
                            const variantData = await response.json();

                            const product = {
                                id: productId,
                                name: this.getAttribute('data-name'),
                                price: parseInt(this.getAttribute('data-price')),
                                image: this.getAttribute('data-image'),
                                variantId: variantData.variantId || null,
                                color: variantData.color || 'ƒêen', // M·∫∑c ƒë·ªãnh m√†u ƒëen
                                size: variantData.size || 'S',     // M·∫∑c ƒë·ªãnh size S
                                quantity: 1
                            };

                            if (window.addToCart) {
                                const success = await window.addToCart(product);
                                if (success) {
                                    // Hi·ªáu ·ª©ng th√¥ng b√°o
                                    this.innerHTML = '<i class="fa-solid fa-check"></i>';
                                    this.style.background = '#28a745';
                                    setTimeout(() => {
                                        this.innerHTML = '<i class="fa-solid fa-cart-shopping"></i>';
                                        this.style.background = '';
                                    }, 1000);
                                }
                            }
                        } catch (error) {
                            console.error('L·ªói khi l·∫•y variant:', error);
                            // Fallback: th√™m kh√¥ng c√≥ variant
                            const product = {
                                id: productId,
                                name: this.getAttribute('data-name'),
                                price: parseInt(this.getAttribute('data-price')),
                                image: this.getAttribute('data-image'),
                                variantId: null,
                                color: 'ƒêen',
                                size: 'S',
                                quantity: 1
                            };
                            window.addToCart(product);
                        }
                    });
                });

            </script>
</body>

</html>